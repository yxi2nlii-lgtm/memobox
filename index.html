<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BAMBOO FLOW - CLEAR GLASS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        /* 1. 背景修正：提高亮度，确保图片可见 */
        body { 
            background: #1a1a1a; /* 改为深灰，避免纯黑吞噬透明度 */
            font-family: 'Poppins', sans-serif; 
            overflow: hidden; 
            height: 100vh; 
            width: 100vw; 
            touch-action: none; 
        }

        .bg-glass {
            position: fixed; inset: 0; z-index: -1;
            background: url('image-10.png') center/cover no-repeat;
            transform: scale(1.5); /* 稍微缩小放大倍数，保持清透 */
            filter: blur(60px) brightness(0.4); /* 调高亮度到 0.6，减小模糊到 60px */
            opacity: 0.9;
        }

        #ios-toast {
            position: fixed; top: -80px; left: 50%; transform: translateX(-50%);
            width: auto; min-width: 200px; height: 44px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px);
            border-radius: 22px; display: flex; align-items: center; justify-content: center; padding: 0 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2); z-index: 5000;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        #ios-toast.active { top: 30px; }
        .toast-text { color: #000; font-size: 13px; font-weight: 600; }

        .center-hub {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            z-index: 1000; pointer-events: none;
        }
        .main-avatar {
            width: 76px; height: 76px; border-radius: 50%; 
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .main-avatar img { width: 100%; height: 100%; object-fit: cover; }

        #hidden-trigger {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 12%;
            z-index: 2000; cursor: default;
        }

        #stage { position: absolute; inset: 0; z-index: 100; pointer-events: none; }
        
        /* 泡泡：增强清透感 */
        .bubble {
            position: absolute; left: 0; top: 0; border-radius: 50%; width: 120px; height: 120px;
            background: rgba(255, 255, 255, 0.12); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); 
            cursor: pointer; pointer-events: auto;
            opacity: 0; will-change: transform, opacity;
            transition: opacity 1.2s ease-out;
        }
        .bubble.spawned { opacity: 1; }
        
        .bubble.is-img img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; opacity: 0.9; }
        .bubble.is-text { padding: 22px; font-size: 11px; color: rgba(255,255,255,0.8); text-align: center; display: flex; align-items: center; justify-content: center; line-height: 1.5; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }

        /* 2. 矢量红点：精确控制 */
        .unread-dot {
            position: absolute; top: 18px; right: 18px; 
            width: 8px; height: 8px; 
            background: #ff3b30; 
            border-radius: 50%; 
            z-index: 200;
        }

        #modal-overlay {
            position: fixed; inset: 0; z-index: 6000; display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(40px); background: rgba(0,0,0,0.3); opacity: 0; transition: 0.4s;
        }
        .modal-card {
            background: rgba(255, 255, 255, 0.95); width: 85%; max-width: 340px; border-radius: 35px; padding: 30px;
            color: #1a1a1a; transform: translateY(20px); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #modal-overlay.active { display: flex; opacity: 1; }
        #modal-overlay.active .modal-card { transform: translateY(0); }
        .modal-img { width: 100%; border-radius: 20px; margin-bottom: 20px; display: none; }
        .modal-actions { display: flex; gap: 20px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 20px; margin-top: 15px; }
        .action-btn svg { width: 24px; height: 24px; fill: none; stroke: #999; stroke-width: 1.5; cursor: pointer; transition: 0.3s; }
        .action-btn.liked svg { fill: #ff3b30; stroke: #ff3b30; }
        .comment-area { max-height: 100px; overflow-y: auto; margin-top: 10px; }
        .comment-item { font-size: 13px; color: #666; margin-top: 6px; padding-left: 8px; border-left: 2px solid #ddd; }
    </style>
</head>
<body>

    <div class="bg-glass"></div>
    <div id="ios-toast"><div class="toast-text">New updates received</div></div>

    <div id="hidden-trigger" onclick="spawnBubble()"></div>

    <div id="modal-overlay" onclick="closeModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <img id="m-img" class="modal-img">
            <p id="m-text" style="font-size: 15px; line-height: 1.6; color: #333;"></p>
            <div class="modal-actions">
                <div id="like-btn" class="action-btn" onclick="toggleLike()">
                    <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                </div>
                <div class="action-btn" onclick="addComment()">
                    <svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                </div>
            </div>
            <div id="m-comments" class="comment-area"></div>
        </div>
    </div>

    <div class="center-hub">
        <div class="main-avatar"><img src="image-10.png"></div>
    </div>
    <div id="stage"></div>

    <script>
        const stage = document.getElementById('stage');
        let bubbles = [];
        let count = 0;
        let activeBubble = null;

        const dataPool = [
            { type: 'text', content: "Quiet updates are the best kind.", detail: "No noise, just the water's rhythm." },
            { type: 'text', content: "The flow knows where to go.", detail: "Trust the water's direction." },
            { type: 'text', content: "Stillness is the root of motion.", detail: "The bamboo forest is deep." },
            { type: 'text', content: "Breathe and drift on.", detail: "Sway but never break." },
            { type: 'img', content: 'image-10.png', detail: "A visual slice of stillness." }
        ];

        function spawnBubble() {
            const data = dataPool[count % dataPool.length];
            const el = document.createElement('div');
            el.className = `bubble is-${data.type}`;
            el.innerHTML = `<div class="unread-dot"></div>${data.type==='img' ? `<img src="${data.content}">` : data.content}`;
            stage.appendChild(el);

            const ww = window.innerWidth, wh = window.innerHeight;
            const cx = ww / 2 - 60, cy = wh / 2 - 60;

            const angle = Math.random() * Math.PI * 2;
            const radius = 180;
            const startX = cx + Math.cos(angle) * radius;
            const startY = cy + Math.sin(angle) * radius;

            const bObj = {
                el, r: 60, x: startX, y: startY,
                vx: 0, vy: 0, liked: false, comments: [], data: data
            };
            bubbles.push(bObj);

            el.style.transform = `translate3d(${startX}px, ${startY}px, 0)`;
            requestAnimationFrame(() => el.classList.add('spawned'));
            
            const toast = document.getElementById('ios-toast');
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 2500);

            el.onclick = () => openModal(bObj);
            count++;
        }

        function openModal(b) {
            activeBubble = b;
            const img = document.getElementById('m-img');
            if(b.data.type === 'img') { img.src = b.data.content; img.style.display = 'block'; }
            else { img.style.display = 'none'; }
            document.getElementById('m-text').innerText = b.data.detail || b.data.content;
            b.el.querySelector('.unread-dot')?.remove();
            renderModalUI();
            const ov = document.getElementById('modal-overlay');
            ov.style.display = 'flex';
            setTimeout(() => ov.classList.add('active'), 10);
        }

        function closeModal() {
            const ov = document.getElementById('modal-overlay');
            ov.classList.remove('active');
            setTimeout(() => ov.style.display = 'none', 400);
        }

        function toggleLike() {
            if(activeBubble) {
                activeBubble.liked = !activeBubble.liked;
                renderModalUI();
            }
        }

        function addComment() {
            const c = prompt("Leave a note:");
            if(c) {
                activeBubble.comments.push(c);
                renderModalUI();
            }
        }

        function renderModalUI() {
            if(!activeBubble) return;
            document.getElementById('like-btn').className = 'action-btn' + (activeBubble.liked ? ' liked' : '');
            document.getElementById('m-comments').innerHTML = activeBubble.comments.map(c => `<div class="comment-item">${c}</div>`).join('');
        }

        function animate() {
            const ww = window.innerWidth, wh = window.innerHeight;
            const cx = ww / 2, cy = wh / 2;

            bubbles.forEach((b, i) => {
                const dx = (b.x + b.r) - cx;
                const dy = (b.y + b.r) - cy;
                const dist = Math.sqrt(dx*dx + dy*dy) || 1;
                
                b.vx += (-dy / dist) * 0.0015;
                b.vy += (dx / dist) * 0.0015;
                b.vx += (cx - (b.x + b.r)) * 0.0001;
                b.vy += (cy - (b.y + b.r)) * 0.0001;

                // 3. 柔和排斥：0.02
                for (let j = i + 1; j < bubbles.length; j++) {
                    const b2 = bubbles[j];
                    const pdx = (b2.x + b2.r) - (b.x + b.r);
                    const pdy = (b2.y + b2.r) - (b.y + b.r);
                    const pdist = Math.sqrt(pdx*pdx + pdy*pdy) || 1;
                    const minDist = 145; 

                    if (pdist < minDist) {
                        const push = (minDist - pdist) * 0.005;
                        const moveX = (pdx / pdist) * push;
                        const moveY = (pdy / pdist) * push;
                        b.vx -= moveX; b.vy -= moveY;
                        b2.vx += moveX; b2.vy += moveY;
                    }
                }

                const coreLimit = 140; 
                if (dist < coreLimit) {
                    const overlap = coreLimit - dist;
                    b.x += (dx/dist) * overlap * 0.1;
                    b.y += (dy/dist) * overlap * 0.1;
                }

                b.vx *= 0.98; b.vy *= 0.98;
                b.x += b.vx; b.y += b.vy;

                if (b.x < 5) { b.x = 5; b.vx *= -0.5; }
                if (b.x > ww - 125) { b.x = ww - 125; b.vx *= -0.5; }
                if (b.y < 5) { b.y = 5; b.vy *= -0.5; }
                if (b.y > wh - 125) { b.y = wh - 125; b.vy *= -0.5; }

                b.el.style.transform = `translate3d(${b.x}px, ${b.y}px, 0)`;
            });
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
