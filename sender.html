<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
</head>
<body>
    <script>
        const firebaseConfig = { /* 同上方的配置内容 */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('flow_messages');

        // 发送逻辑升级
        function sendData(localPayload, remotePayload = null) {
            // 1. 保存本地发送历史
            const history = JSON.parse(localStorage.getItem('my_sent_history') || '[]');
            history.push(localPayload);
            localStorage.setItem('my_sent_history', JSON.stringify(history));
            
            // 2. 推送到 Firebase (云端)
            const finalRemoteData = remotePayload || localPayload;
            db.push(finalRemoteData); 
            
            refreshState();
        }

        function clearAll() {
            localStorage.setItem('my_sent_history', '[]');
            db.set({ clear: { type: 'clear_all', time: Date.now() } }); 
            location.reload();
        }
    </script>
</body>
</html>
